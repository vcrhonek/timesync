# {{ ansible_managed }}

{% for value in timesync_ptp_domains %}
[ptp_domain {{ value['number'] }}]
interfaces {{ value['interfaces']|join(' ') }}
{% if 'delay' in value %}
delay {{ value['delay'] }}
{% endif %}
{% if 'transport' in value %}
ptp4l_option network_transport {{ value['transport'] }}
{% endif %}
{% if 'udp_ttl' in value %}
ptp4l_option udp_ttl {{ value['udp_ttl'] }}
{% endif %}

{% endfor %}
[timemaster]
ntp_program {{ timesync_ntp_service if timesync_ntp_provider == 'ntp' else timesync_chrony_service }}

[chrony.conf]
include /etc/chrony.conf

[ntp.conf]
includefile /etc/ntp.conf

[ptp4l.conf]

[chronyd]
path /usr/sbin/chronyd
{% if timesync_ntp_provider == 'chrony' and __timesync_chrony_version is version('1.30', '<') %}
options -u {{ timesync_chrony_user }}
{% endif %}

[ntpd]
path /usr/sbin/ntpd
options -u {{ timesync_ntp_user }}:{{ timesync_ntp_group|default(timesync_ntp_user, true) }} -g

[phc2sys]
path /usr/sbin/phc2sys
options -l 6

[ptp4l]
path /usr/sbin/ptp4l
options -l 6
